

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>iblrig.gui.tools &mdash; iblrig 8.24.7 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_lesson.css?v=0c089442" />
      <link rel="stylesheet" type="text/css" href="../../../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=43b36fd3"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            iblrig
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Using IBLRIG v8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware.html">Hardware Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference_developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">Frequently Asked Questions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/int-brain-lab/iblrig">IBLRIG on GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://doi.org/10.6084/m9.figshare.11634732">Appendix 3: IBL protocol for setting up the behavioral training rig</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">iblrig</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">iblrig.gui.tools</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for iblrig.gui.tools</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">disk_usage</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QObject</span><span class="p">,</span>
    <span class="n">QRunnable</span><span class="p">,</span>
    <span class="n">Qt</span><span class="p">,</span>
    <span class="n">QThreadPool</span><span class="p">,</span>
    <span class="n">pyqtProperty</span><span class="p">,</span>
    <span class="n">pyqtSignal</span><span class="p">,</span>
    <span class="n">pyqtSlot</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QStandardItem</span><span class="p">,</span> <span class="n">QStandardItemModel</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QListView</span><span class="p">,</span> <span class="n">QProgressBar</span><span class="p">,</span> <span class="n">QPushButton</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">HTTPError</span>

<span class="kn">from</span> <span class="nn">iblrig.constants</span> <span class="kn">import</span> <span class="n">BASE_PATH</span>
<span class="kn">from</span> <span class="nn">iblrig.gui</span> <span class="kn">import</span> <span class="n">resources_rc</span>  <span class="c1"># noqa: F401</span>
<span class="kn">from</span> <span class="nn">iblrig.net</span> <span class="kn">import</span> <span class="n">get_remote_devices</span>
<span class="kn">from</span> <span class="nn">iblrig.pydantic_definitions</span> <span class="kn">import</span> <span class="n">RigSettings</span>
<span class="kn">from</span> <span class="nn">iblutil.util</span> <span class="kn">import</span> <span class="n">dir_size</span>
<span class="kn">from</span> <span class="nn">one.webclient</span> <span class="kn">import</span> <span class="n">AlyxClient</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="convert_uis">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.convert_uis.html#iblrig.gui.tools.convert_uis">[docs]</a>
<span class="k">def</span> <span class="nf">convert_uis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A wrapper for PyQt5&#39;s pyuic5 and pyrcc5, set up for development on iblrig.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;pattern&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;*.*&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">gui_path</span> <span class="o">=</span> <span class="n">BASE_PATH</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;iblrig&#39;</span><span class="p">,</span> <span class="s1">&#39;gui&#39;</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">gui_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">pattern</span><span class="p">)])</span>

    <span class="k">for</span> <span class="n">filename_in</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">gui_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.qrc&#39;</span><span class="p">)):</span>
        <span class="n">rel_path_in</span> <span class="o">=</span> <span class="n">filename_in</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">BASE_PATH</span><span class="p">)</span>
        <span class="n">rel_path_out</span> <span class="o">=</span> <span class="n">rel_path_in</span><span class="o">.</span><span class="n">with_stem</span><span class="p">(</span><span class="n">rel_path_in</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s1">&#39;_rc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pyrcc5&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path_in</span><span class="p">),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path_out</span><span class="p">)]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">BASE_PATH</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">filename_in</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">gui_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.ui&#39;</span><span class="p">)):</span>
        <span class="n">rel_path_in</span> <span class="o">=</span> <span class="n">filename_in</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">BASE_PATH</span><span class="p">)</span>
        <span class="n">rel_path_out</span> <span class="o">=</span> <span class="n">rel_path_in</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pyuic5&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path_in</span><span class="p">),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path_out</span><span class="p">),</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="s1">&#39;--import-from=iblrig.gui&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">BASE_PATH</span><span class="p">)</span></div>



<div class="viewcode-block" id="WorkerSignals">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.WorkerSignals.html#iblrig.gui.tools.WorkerSignals">[docs]</a>
<span class="k">class</span> <span class="nc">WorkerSignals</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Signals used by the Worker class to communicate with the main thread.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    finished : pyqtSignal</span>
<span class="sd">        Signal emitted when the worker has finished its task.</span>

<span class="sd">    error : pyqtSignal(tuple)</span>
<span class="sd">        Signal emitted when an error occurs. The signal carries a tuple with the exception type,</span>
<span class="sd">        exception value, and the formatted traceback.</span>

<span class="sd">    result : pyqtSignal(Any)</span>
<span class="sd">        Signal emitted when the worker has successfully completed its task. The signal carries</span>
<span class="sd">        the result of the task.</span>

<span class="sd">    progress : pyqtSignal(int)</span>
<span class="sd">        Signal emitted to report progress during the task. The signal carries an integer value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">finished</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></div>



<div class="viewcode-block" id="DiskSpaceIndicator">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.DiskSpaceIndicator.html#iblrig.gui.tools.DiskSpaceIndicator">[docs]</a>
<span class="k">class</span> <span class="nc">DiskSpaceIndicator</span><span class="p">(</span><span class="n">QProgressBar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A custom progress bar widget that indicates the disk space usage of a specified directory.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiskSpaceIndicator.__init__">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.DiskSpaceIndicator.html#iblrig.gui.tools.DiskSpaceIndicator.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">percent_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the DiskSpaceIndicator with the specified directory and threshold percentage.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : tuple</span>
<span class="sd">            Variable length argument list (passed to QProgressBar).</span>
<span class="sd">        directory : Path or None</span>
<span class="sd">            The directory path to monitor for disk space usage.</span>
<span class="sd">        percent_threshold : int, optional</span>
<span class="sd">            The threshold percentage at which the progress bar changes color to red. Default is 90.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Arbitrary keyword arguments (passed to QProgressBar).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="n">directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_percent_threshold</span> <span class="o">=</span> <span class="n">percent_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_percent_full</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_data</span><span class="p">()</span></div>


<div class="viewcode-block" id="DiskSpaceIndicator.update_data">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.DiskSpaceIndicator.html#iblrig.gui.tools.DiskSpaceIndicator.update_data">[docs]</a>
    <span class="k">def</span> <span class="nf">update_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the disk space information.&quot;&quot;&quot;</span>
        <span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_size</span><span class="p">)</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_get_size_result</span><span class="p">)</span>
        <span class="n">QThreadPool</span><span class="o">.</span><span class="n">globalInstance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if the disk space usage is above the given threshold percentage.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_percent_full</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_percent_threshold</span>

    <span class="k">def</span> <span class="nf">_get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the disk usage information for the specified directory.&quot;&quot;&quot;</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="n">disk_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="o">.</span><span class="n">anchor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_percent_full</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">used</span> <span class="o">/</span> <span class="n">usage</span><span class="o">.</span><span class="n">total</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gigs_dir</span> <span class="o">=</span> <span class="n">dir_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gigs_free</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">free</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>

    <span class="k">def</span> <span class="nf">_on_get_size_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the result of getting disk usage information and update the progress bar accordingly.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_percent_full</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">critical</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Highlight</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPalette</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_gigs_dir</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> GB  •  &#39;</span> <span class="sa">f</span><span class="s1">&#39;available space: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_gigs_free</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> GB&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Worker">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.Worker.html#iblrig.gui.tools.Worker">[docs]</a>
<span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">QRunnable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generic worker class for executing functions concurrently in a separate thread.</span>

<span class="sd">    This class is designed to run functions concurrently in a separate thread and emit signals</span>
<span class="sd">    to communicate the results or errors back to the main thread.</span>

<span class="sd">    Adapted from: https://www.pythonguis.com/tutorials/multithreading-pyqt-applications-qthreadpool/</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    fn : Callable</span>
<span class="sd">        The function to be executed concurrently.</span>

<span class="sd">    args : tuple</span>
<span class="sd">        Positional arguments for the function.</span>

<span class="sd">    kwargs : dict</span>
<span class="sd">        Keyword arguments for the function.</span>

<span class="sd">    signals : WorkerSignals</span>
<span class="sd">        An instance of WorkerSignals used to emit signals.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    run() -&gt; None</span>
<span class="sd">        The main entry point for running the worker. Executes the provided function and</span>
<span class="sd">        emits signals accordingly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Worker.__init__">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.Worker.html#iblrig.gui.tools.Worker.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Worker instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fn : Callable</span>
<span class="sd">            The function to be executed concurrently.</span>

<span class="sd">        *args : tuple</span>
<span class="sd">            Positional arguments for the function.</span>

<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments for the function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">:</span> <span class="n">WorkerSignals</span> <span class="o">=</span> <span class="n">WorkerSignals</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;progress_callback&#39;</span> <span class="ow">in</span> <span class="n">signature</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;progress_callback&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">progress</span></div>


<div class="viewcode-block" id="Worker.run">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.Worker.html#iblrig.gui.tools.Worker.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the provided function and emit signals accordingly.</span>

<span class="sd">        This method is the main entry point for running the worker. It executes the provided</span>
<span class="sd">        function and emits signals to communicate the results or errors back to the main thread.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
            <span class="c1"># Handle exceptions and emit error signal with exception details</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="n">exctype</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">emit</span><span class="p">((</span><span class="n">exctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Emit result signal with the result of the task</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Emit the finished signal to indicate completion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="RemoteDevicesListView">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.RemoteDevicesListView.html#iblrig.gui.tools.RemoteDevicesListView">[docs]</a>
<span class="k">class</span> <span class="nc">RemoteDevicesListView</span><span class="p">(</span><span class="n">QListView</span><span class="p">):</span>
<div class="viewcode-block" id="RemoteDevicesListView.__init__">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.RemoteDevicesListView.html#iblrig.gui.tools.RemoteDevicesListView.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># needed for status tips</span></div>


<div class="viewcode-block" id="RemoteDevicesListView.getDevices">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.RemoteDevicesListView.html#iblrig.gui.tools.RemoteDevicesListView.getDevices">[docs]</a>
    <span class="k">def</span> <span class="nf">getDevices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">():</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">itemData</span><span class="p">(</span><span class="n">idx</span><span class="p">)[</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">out</span></div>
</div>



<div class="viewcode-block" id="RemoteDevicesItemModel">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.RemoteDevicesItemModel.html#iblrig.gui.tools.RemoteDevicesItemModel">[docs]</a>
<span class="k">class</span> <span class="nc">RemoteDevicesItemModel</span><span class="p">(</span><span class="n">QStandardItemModel</span><span class="p">):</span>
<div class="viewcode-block" id="RemoteDevicesItemModel.__init__">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.RemoteDevicesItemModel.html#iblrig.gui.tools.RemoteDevicesItemModel.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">iblrig_settings</span><span class="p">:</span> <span class="n">RigSettings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote_devices</span> <span class="o">=</span> <span class="n">get_remote_devices</span><span class="p">(</span><span class="n">iblrig_settings</span><span class="o">=</span><span class="n">iblrig_settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="RemoteDevicesItemModel.update">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.RemoteDevicesItemModel.html#iblrig.gui.tools.RemoteDevicesItemModel.update">[docs]</a>
    <span class="nd">@pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">device_name</span><span class="p">,</span> <span class="n">device_address</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_devices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="n">device_name</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Remote Device &quot;</span><span class="si">{</span><span class="n">device_name</span><span class="si">}</span><span class="s1">&quot; - </span><span class="si">{</span><span class="n">device_address</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">device_name</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="AlyxObject">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.AlyxObject.html#iblrig.gui.tools.AlyxObject">[docs]</a>
<span class="k">class</span> <span class="nc">AlyxObject</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to manage user authentication with an AlyxClient.</span>

<span class="sd">    This class provides methods to log in and log out users, emitting signals to indicate changes in authentication status.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    alyxUrl : str, optional</span>
<span class="sd">        The base URL for the Alyx API. If provided, an AlyxClient will be created.</span>
<span class="sd">    alyxClient : AlyxClient, optional</span>
<span class="sd">        An existing AlyxClient instance. If provided, it will be used for authentication.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    isLoggedIn : bool</span>
<span class="sd">        Indicates whether a user is currently logged in.</span>
<span class="sd">    username : str or None</span>
<span class="sd">        The username of the logged-in user, or None if not logged in.</span>
<span class="sd">    statusChanged : pyqtSignal</span>
<span class="sd">        Emitted when the login status changes (logged in or out). The signal carries a boolean indicating the new status.</span>
<span class="sd">    loggedIn : pyqtSignal</span>
<span class="sd">        Emitted when a user logs in. The signal carries a string representing the username.</span>
<span class="sd">    loggedOut : pyqtSignal</span>
<span class="sd">        Emitted when a user logs out. The signal carries a string representing the username.</span>
<span class="sd">    loginFailed : pyqtSignal</span>
<span class="sd">        Emitted when a login attempt fails. The signal carries a string representing the username.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">statusChanged</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">loggedIn</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">loggedOut</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">loginFailed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<div class="viewcode-block" id="AlyxObject.__init__">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.AlyxObject.html#iblrig.gui.tools.AlyxObject.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">alyxUrl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">alyxClient</span><span class="p">:</span> <span class="n">AlyxClient</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the AlyxObject.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : tuple</span>
<span class="sd">            Positional arguments for QObject.</span>
<span class="sd">        alyxUrl : str, optional</span>
<span class="sd">            The base URL for the Alyx API.</span>
<span class="sd">        alyxClient : AlyxClient, optional</span>
<span class="sd">            An existing AlyxClient instance.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments for QObject.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">icon</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">alyxUrl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">AlyxClient</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="n">alyxUrl</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">alyxClient</span></div>


<div class="viewcode-block" id="AlyxObject.logIn">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.AlyxObject.html#iblrig.gui.tools.AlyxObject.logIn">[docs]</a>
    <span class="nd">@pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="nd">@pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">logIn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cacheToken</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs in a user with the provided username and password.</span>

<span class="sd">        Emits the loggedIn and statusChanged signals if the logout is successful, and the loginFailed signal otherwise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        username : str</span>
<span class="sd">            The username of the user attempting to log in.</span>
<span class="sd">        password : str or None, optional</span>
<span class="sd">            The password of the user. If None, the login will proceed without a password.</span>
<span class="sd">        cacheToken : bool, optional</span>
<span class="sd">            Whether to cache the authentication token.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the login was successful, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">cache_token</span><span class="o">=</span><span class="n">cacheToken</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="mi">400</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">)):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loginFailed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_logged_in</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">username</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Logged into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2"> as user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statusChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loggedIn</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="AlyxObject.logOut">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.AlyxObject.html#iblrig.gui.tools.AlyxObject.logOut">[docs]</a>
    <span class="nd">@pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">logOut</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs out the currently logged-in user.</span>

<span class="sd">        Emits the loggedOut and statusChanged signals if the logout is successful.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLoggedIn</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">connected</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_logged_in</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; logged out of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statusChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">connected</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loggedOut</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">username</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isLoggedIn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Indicates whether a user is currently logged in.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_logged_in</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span> <span class="n">AlyxClient</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">username</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The username of the logged-in user, or None if not logged in.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">user</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLoggedIn</span> <span class="k">else</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="LineEditAlyxUser">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.LineEditAlyxUser.html#iblrig.gui.tools.LineEditAlyxUser">[docs]</a>
<span class="k">class</span> <span class="nc">LineEditAlyxUser</span><span class="p">(</span><span class="n">QLineEdit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom QLineEdit widget for managing user login with an AlyxObject.</span>

<span class="sd">    This widget displays a checkmark icon to indicate the connection status</span>
<span class="sd">    and allows the user to input their username for logging in.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *args : tuple</span>
<span class="sd">        Positional arguments passed to the QLineEdit constructor.</span>
<span class="sd">    alyx : AlyxObject</span>
<span class="sd">        An instance of AlyxObject used to manage login and connection status.</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Keyword arguments passed to the QLineEdit constructor.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LineEditAlyxUser.__init__">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.LineEditAlyxUser.html#iblrig.gui.tools.LineEditAlyxUser.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">alyx</span><span class="p">:</span> <span class="n">AlyxObject</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the LineEditAlyxUser widget.</span>

<span class="sd">        Sets up the checkmark icon, connects signals for login status,</span>
<span class="sd">        and configures the line edit based on the AlyxObject&#39;s state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : tuple</span>
<span class="sd">            Positional arguments passed to the QLineEdit constructor.</span>
<span class="sd">        alyx : AlyxObject</span>
<span class="sd">            An instance of AlyxObject.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments passed to the QLineEdit constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alyx</span> <span class="o">=</span> <span class="n">alyx</span>

        <span class="c1"># Use a QAction to indicate the connection status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkmarkIcon</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s1">&#39;:/images/check&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checkmarkIcon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActionPosition</span><span class="o">.</span><span class="n">TrailingPosition</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s1">&#39;not logged in&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">statusChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onStatusChanged</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logIn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onStatusChanged</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">isLoggedIn</span><span class="p">)</span></div>


    <span class="nd">@pyqtSlot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onStatusChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connected</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set some of the widget&#39;s properties depending on the current connection-status.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkmarkIcon</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">connected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkmarkIcon</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Connected to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">connected</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">username</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="n">connected</span><span class="p">)</span>

<div class="viewcode-block" id="LineEditAlyxUser.logIn">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.LineEditAlyxUser.html#iblrig.gui.tools.LineEditAlyxUser.logIn">[docs]</a>
    <span class="nd">@pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">logIn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attempt to log in using the line edit&#39;s current text.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">logIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="StatefulButton">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.StatefulButton.html#iblrig.gui.tools.StatefulButton">[docs]</a>
<span class="k">class</span> <span class="nc">StatefulButton</span><span class="p">(</span><span class="n">QPushButton</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A QPushButton that maintains an active/inactive state and emits different signals</span>
<span class="sd">    based on its state when clicked.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    active : bool, optional</span>
<span class="sd">        Initial state of the button (default is False).</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    clickedWhileActive : pyqtSignal</span>
<span class="sd">        Emitted when the button is clicked while it is in the active state.</span>
<span class="sd">    clickedWhileInactive : pyqtSignal</span>
<span class="sd">        Emitted when the button is clicked while it is in the inactive state.</span>
<span class="sd">    stateChanged : pyqtSignal</span>
<span class="sd">        Emitted when the button&#39;s state has changed. The signal carries the new state.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">clickedWhileActive</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">clickedWhileInactive</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">stateChanged</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

<div class="viewcode-block" id="StatefulButton.__init__">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.StatefulButton.html#iblrig.gui.tools.StatefulButton.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the StateButton with the specified active state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : tuple</span>
<span class="sd">            Positional arguments to be passed to the QPushButton constructor.</span>
<span class="sd">        active : bool, optional</span>
<span class="sd">            Initial state of the button (default is False).</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments to be passed to the QPushButton constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isActive</span> <span class="o">=</span> <span class="n">active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onClick</span><span class="p">)</span></div>


    <span class="nd">@pyqtProperty</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">isActive</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the active state of the button.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the button is active, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isActive</span>

<div class="viewcode-block" id="StatefulButton.setActive">
<a class="viewcode-back" href="../../../api/iblrig.gui.tools.StatefulButton.html#iblrig.gui.tools.StatefulButton.setActive">[docs]</a>
    <span class="nd">@pyqtSlot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setActive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the active state of the button.</span>

<span class="sd">        Emits `stateChanged` if the state has changed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        active : bool</span>
<span class="sd">            The new active state of the button.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isActive</span> <span class="o">!=</span> <span class="n">active</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_isActive</span> <span class="o">=</span> <span class="n">active</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isActive</span><span class="p">)</span></div>


    <span class="nd">@pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_onClick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the button click event.</span>

<span class="sd">        Emits `clickedWhileActive` if the button is active,</span>
<span class="sd">        otherwise emits `clickedWhileInactive`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isActive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clickedWhileActive</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clickedWhileInactive</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018 – 2024 International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>